<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VplazaOS 2.0</title>
    <link rel="icon" href="/images/logoos.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1810 50%, #1a1a1a 100%);
            background-image: url('https://hebbkx1anhila5yf.public.blob.vercel-storage.com/image-eEJhDAJaG5uYaMuVXDO1jJ3G3I4wRR.png');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            height: 100vh;
            overflow: hidden;
            color: white;
            transition: all 0.3s ease;
        }

        .boot-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }

        .boot-logo {
            font-size: 3rem;
            font-weight: 300;
            margin-bottom: 2rem;
            opacity: 0;
            animation: fadeInUp 0.8s ease forwards;
        }

        .boot-progress {
            width: 300px;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .boot-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #007AFF, #00D4FF);
            width: 0%;
            animation: bootProgress 2s ease forwards;
            border-radius: 2px;
        }

        .boot-text {
            font-size: 0.9rem;
            opacity: 0.7;
            animation: fadeIn 0.5s ease forwards 0.5s;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes bootProgress {
            0% { width: 0%; }
            50% { width: 60%; }
            100% { width: 100%; }
        }

        .desktop {
            width: 100%;
            height: 100vh;
            position: relative;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .desktop.loaded {
            opacity: 1;
        }

        .main-area {
            width: 100%;
            height: 100vh;
            position: relative;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, 120px);
            grid-template-rows: repeat(auto-fill, 120px);
            gap: 20px;
            align-content: start;
            overflow: hidden;
        }

        .desktop-icon {
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .desktop-icon:hover {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .desktop-icon i {
            font-size: 2rem;
            margin-bottom: 8px;
            color: #007AFF;
        }

        .desktop-icon .icon-label {
            font-size: 0.8rem;
            text-align: center;
            font-weight: 500;
        }

        .dock-toggle {
            position: fixed;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 20px;
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 1001;
            transition: all 0.3s ease;
        }

        .dock-toggle.hidden {
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 20px;
            border-radius: 10px;
        }

        .dock-toggle i {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.8);
            transition: transform 0.3s ease;
        }

        .dock-toggle.hidden i {
            transform: rotate(180deg);
        }

        .dock {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.4);
            backdrop-filter: blur(20px);
            border-radius: 5px;
            padding: 6px 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            border: 1px solid rgba(255,255,255,0.1);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .dock.hidden {
            transform: translateX(-50%) translateY(100px);
            opacity: 0;
            pointer-events: none;
        }

        .search-container {
            position: relative;
            margin-right: 20px;
        }

        .search-input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            padding: 8px 40px 8px 15px;
            color: white;
            font-size: 0.9rem;
            width: 300px;
            outline: none;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            background: rgba(255,255,255,0.2);
            border-color: #007AFF;
            box-shadow: 0 0 20px rgba(0,122,255,0.3);
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.6);
        }

        .search-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: rgba(255,255,255,0.7);
            cursor: pointer;
            font-size: 1rem;
        }

        .dock-item {
            width: 40px;
            height: 40px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .dock-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-5px);
        }

        .dock-item.active {
            background: rgba(0,122,255,0.5);
        }

        .dock-item.active::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 4px;
            background: #007AFF;
            border-radius: 50%;
        }

        .window {
            position: absolute;
            background: rgba(20,20,20,0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            min-width: 400px;
            min-height: 300px;
            display: none;
            flex-direction: column;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            overflow: hidden;
            z-index: 100;
        }

        .window.show {
            display: flex;
            animation: windowOpen 0.3s ease;
        }

        .window.minimized {
            transform: scale(0.1);
            opacity: 0;
        }

        .window.custom-fullscreen {
            top: 40px !important;
            left: 40px !important;
            width: calc(100vw - 80px) !important;
            height: calc(100vh - 80px) !important;
            border-radius: 8px !important;
            z-index: 200;
        }

        .window.custom-fullscreen .window-content {
            height: calc(100vh - 140px) !important;
            overflow: hidden !important;
        }

        .window.custom-fullscreen .window-content iframe {
            width: 100% !important;
            height: 100% !important;
            border: none !important;
            overflow: hidden !important;
            max-width: 100% !important;
            max-height: 100% !important;
        }

        @keyframes windowOpen {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .window-header {
            background: linear-gradient(135deg, rgba(60,60,60,0.9) 0%, rgba(40,40,40,0.9) 100%);
            padding: 8px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px 8px 0 0;
        }

        .window-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
            font-size: 0.9rem;
            color: #e0e0e0;
        }

        .window-controls {
            display: flex;
            gap: 6px;
            order: -1;
        }

        .window-control {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid rgba(0,0,0,0.3);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .window-control.close {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
        }

        .window-control.minimize {
            background: linear-gradient(135deg, #ffd93d, #ffcd02);
        }

        .window-control.maximize {
            background: linear-gradient(135deg, #6bcf7f, #57c267);
        }

        .window-control:hover {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .window-control.close:hover::after {
            content: '√ó';
            color: #fff;
            font-size: 10px;
            font-weight: bold;
        }

        .window-control.minimize:hover::after {
            content: '‚àí';
            color: #333;
            font-size: 10px;
            font-weight: bold;
        }

        .window-control.maximize:hover::after {
            content: '‚ñ°';
            color: #fff;
            font-size: 8px;
            font-weight: bold;
        }

        .window-content {
            flex: 1;
            padding: 0;
            background: rgba(255,255,255,0.02);
            overflow: hidden;
        }

        .window-content iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            overflow: hidden;
            max-width: 100%;
            max-height: 100%;
            box-sizing: border-box;
        }

        .status-bar {
            position: fixed;
            top: 0;
            right: 0;
            padding: 10px 20px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            border-radius: 0 0 0 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.85rem;
            z-index: 1001;
        }

        .status-bar i {
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .status-bar i:hover {
            color: #007AFF;
            transform: scale(1.1);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(20,20,20,0.95);
            backdrop-filter: blur(20px);
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            padding: 15px 20px;
            max-width: 300px;
            z-index: 4000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .resize-handle {
            position: absolute;
            background: transparent;
        }

        .resize-handle.n { top: 0; left: 0; right: 0; height: 5px; cursor: n-resize; }
        .resize-handle.s { bottom: 0; left: 0; right: 0; height: 5px; cursor: s-resize; }
        .resize-handle.e { top: 0; right: 0; bottom: 0; width: 5px; cursor: e-resize; }
        .resize-handle.w { top: 0; left: 0; bottom: 0; width: 5px; cursor: w-resize; }
        .resize-handle.ne { top: 0; right: 0; width: 10px; height: 10px; cursor: ne-resize; }
        .resize-handle.nw { top: 0; left: 0; width: 10px; height: 10px; cursor: nw-resize; }
        .resize-handle.se { bottom: 0; right: 0; width: 10px; height: 10px; cursor: se-resize; }
        .resize-handle.sw { bottom: 0; left: 0; width: 10px; height: 10px; cursor: sw-resize; }

        .hidden {
            display: none !important;
        }

        .terminal {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 20px;
            height: 100%;
            overflow-y: auto;
        }

        .terminal-input {
            background: transparent;
            border: none;
            color: #00ff00;
            font-family: inherit;
            font-size: inherit;
            outline: none;
            width: 100%;
        }
    </style>
</head>
<body>
    <div class="boot-screen" id="bootScreen">
        <div class="boot-logo">VplazaOS</div>
        <div class="boot-progress">
            <div class="boot-progress-bar"></div>
        </div>
        <div class="boot-text">Starting your operating system...</div>
    </div>

    <div class="desktop" id="desktop">
        <div class="main-area" id="mainArea">
            <div class="desktop-icon" onclick="openApp('browser')">
                <i class="bi bi-globe"></i>
                <div class="icon-label">Browser</div>
            </div>
            <div class="desktop-icon" onclick="openApp('music')">
                <i class="bi bi-music-note-beamed"></i>
                <div class="icon-label">Music</div>
            </div>
            <div class="desktop-icon" onclick="openApp('games')">
                <i class="bi bi-controller"></i>
                <div class="icon-label">Games</div>
            </div>
            <div class="desktop-icon" onclick="openApp('calculator')">
                <i class="bi bi-calculator"></i>
                <div class="icon-label">Calculator</div>
            </div>
            <div class="desktop-icon" onclick="openApp('notes')">
                <i class="bi bi-journal-text"></i>
                <div class="icon-label">Notes</div>
            </div>
            <div class="desktop-icon" onclick="openApp('weather')">
                <i class="bi bi-cloud-sun"></i>
                <div class="icon-label">Weather</div>
            </div>
        </div>

        <div class="dock-toggle" id="dockToggle" onclick="toggleDock()">
            <i class="bi bi-chevron-down"></i>
        </div>

        <div class="dock" id="dock">
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Search or enter URL..." id="searchInput">
                <button class="search-btn" onclick="handleSearch()">
                    <i class="bi bi-search"></i>
                </button>
            </div>
            <div class="dock-item" onclick="openApp('browser')">
                <i class="bi bi-globe"></i>
            </div>
            <div class="dock-item" onclick="openApp('files')">
                <i class="bi bi-folder"></i>
            </div>
            <div class="dock-item" onclick="openApp('media')">
                <i class="bi bi-play-circle"></i>
            </div>
            <div class="dock-item" onclick="openApp('taskmanager')">
                <i class="bi bi-cpu"></i>
            </div>
            <div class="dock-item" onclick="openApp('terminal')">
                <i class="bi bi-terminal"></i>
            </div>
            <div class="dock-item" onclick="openApp('about')">
                <i class="bi bi-info-circle"></i>
            </div>
            <div class="dock-item" onclick="openApp('chat')">
                <i class="bi bi-chat-dots"></i>
            </div>
            <div class="dock-item" onclick="openApp('texteditor')">
                <i class="bi bi-file-text"></i>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <span id="weatherInfo">Loading weather...</span>
        <span id="currentTime">05:37 PM</span>
        <i class="bi bi-power" onclick="showPowerOptions()"></i>
        <i class="bi bi-wifi"></i>
        <i class="bi bi-person-circle"></i>
        <i class="bi bi-battery-full"></i>
    </div>

    <script>
        let windowCounter = 0;
        let activeWindows = new Map();
        let openWindows = new Map(); // Changed to Map to store window IDs
        let draggedWindow = null;
        let dragOffset = { x: 0, y: 0 };
        let resizingWindow = null;
        let resizeData = {};
        let dockHidden = false;

        function startDesktop() {
            const bootScreen = document.getElementById('bootScreen');
            const desktop = document.getElementById('desktop');
            
            bootScreen.style.opacity = '0';
            setTimeout(() => {
                bootScreen.style.display = 'none';
                desktop.classList.add('loaded');
                loadWeather();
            }, 500);
        }

        setTimeout(startDesktop, 2500);

        function toggleDock() {
            const dock = document.getElementById('dock');
            const toggle = document.getElementById('dockToggle');
            const toggleIcon = toggle.querySelector('i');
            
            dockHidden = !dockHidden;
            
            if (dockHidden) {
                dock.classList.add('hidden');
                toggle.classList.add('hidden');
                toggleIcon.className = 'bi bi-chevron-up';
            } else {
                dock.classList.remove('hidden');
                toggle.classList.remove('hidden');
                toggleIcon.className = 'bi bi-chevron-down';
            }
        }

        async function loadWeather() {
            try {
                document.getElementById('weatherInfo').textContent = 'üå§Ô∏è 77¬∞F';
            } catch (error) {
                document.getElementById('weatherInfo').textContent = 'üå§Ô∏è 77¬∞F';
            }
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString([], {
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        setInterval(updateTime, 1000);
        updateTime();

        function showNotification(title, message) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                <div style="font-size: 0.9rem; opacity: 0.8;">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        function handleSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if (!query) return;

            let url;
            let displayTitle = 'Browser';
            
            if (query.startsWith('http://') || query.startsWith('https://')) {
                url = query;
                try {
                    const urlObj = new URL(query);
                    displayTitle = urlObj.hostname.replace('www.', '').split('.')[0];
                    displayTitle = displayTitle.charAt(0).toUpperCase() + displayTitle.slice(1);
                } catch (e) {
                    displayTitle = 'Browser';
                }
            } else if (query.includes('.') && !query.includes(' ')) {
                url = 'https://' + query;
                displayTitle = query.replace('www.', '').split('.')[0];
                displayTitle = displayTitle.charAt(0).toUpperCase() + displayTitle.slice(1);
            } else {
                url = 'https://search.brave.com/search?q=' + encodeURIComponent(query);
                displayTitle = 'Google Search';
            }

            openApp('browser', url, displayTitle);
            document.getElementById('searchInput').value = '';
        }

        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                handleSearch();
            }
        });

        function openApp(appName, customUrl = null, customTitle = null) {
            // Check if this app type is already open
            if (openWindows.has(appName)) {
                const existingWindowId = openWindows.get(appName);
                const existingWindow = document.getElementById(existingWindowId);
                
                if (existingWindow) {
                    // Focus the existing window
                    focusWindow(existingWindowId);
                    showNotification('Window Already Open', `${appName} is already running. Focusing existing window.`);
                    return;
                }
            }

            const windowId = `window-${++windowCounter}`;
            
            const apps = {
                browser: {
                    title: customTitle || 'Browser',
                    icon: 'bi-globe',
                    url: customUrl || 'https://www.google.com'
                },
                terminal: {
                    title: 'Terminal',
                    icon: 'bi-terminal',
                    isTerminal: true
                },
                files: {
                    title: 'Files',
                    icon: 'bi-folder',
                    url: 'https://example.com'
                },
                about: {
                    title: 'About',
                    icon: 'bi-info-circle',
                    isAbout: true
                },
                texteditor: {
                    title: 'Text Editor',
                    icon: 'bi-file-text',
                    isTextEditor: true
                },
                media: {
                    title: 'Media Viewer',
                    icon: 'bi-play-circle',
                    url: 'https://example.com'
                },
                taskmanager: {
                    title: 'Task Manager',
                    icon: 'bi-cpu',
                    isTaskManager: true
                },
                chat: {
                    title: 'Chat',
                    icon: 'bi-chat-dots',
                    url: 'https://example.com'
                },
                music: {
                    title: 'Music Player',
                    icon: 'bi-music-note-beamed',
                    url: 'https://open.spotify.com'
                },
                games: {
                    title: 'Games',
                    icon: 'bi-controller',
                    url: 'https://example.com'
                },
                calculator: {
                    title: 'Calculator',
                    icon: 'bi-calculator',
                    isCalculator: true
                },
                notes: {
                    title: 'Notes',
                    icon: 'bi-journal-text',
                    isNotes: true
                },
                weather: {
                    title: 'Weather',
                    icon: 'bi-cloud-sun',
                    isWeather: true
                }
            };

            const app = apps[appName];
            if (!app) return;

            createWindow(windowId, app, appName);
            activeWindows.set(windowId, app);
            openWindows.set(appName, windowId); // Store the window ID for this app type
            updateDockActiveApps();
        }

        function updateDockActiveApps() {
            const dockItems = document.querySelectorAll('.dock-item');
            dockItems.forEach(item => {
                item.classList.remove('active');
            });
            
            openWindows.forEach((windowId, appName) => {
                const dockItem = document.querySelector(`.dock-item[onclick*="${appName}"]`);
                if (dockItem) {
                    dockItem.classList.add('active');
                }
            });
        }

        function focusWindow(windowId) {
            const window = document.getElementById(windowId);
            if (window) {
                window.style.zIndex = 1000 + windowCounter++;
                if (window.style.display === 'none') {
                    window.style.display = 'flex';
                    window.classList.remove('minimized');
                }
            }
        }

        function createWindow(windowId, app, appName) {
            const window = document.createElement('div');
            window.className = 'window';
            window.id = windowId;
            window.setAttribute('data-app', appName);
            
            const header = document.createElement('div');
            header.className = 'window-header';
            header.innerHTML = `
                <div class="window-controls">
                    <div class="window-control close" onclick="closeWindow('${windowId}', '${appName}')"></div>
                    <div class="window-control minimize" onclick="minimizeWindow('${windowId}')"></div>
                    <div class="window-control maximize" onclick="toggleCustomFullscreen('${windowId}')"></div>
                </div>
                <div class="window-title">
                    <i class="${app.icon}"></i>
                    <span>${app.title}</span>
                </div>
            `;

            const content = document.createElement('div');
            content.className = 'window-content';

            if (app.isTerminal) {
                content.innerHTML = `
                    <div class="terminal">
                        <div id="terminal-output-${windowId}">VplazaOS Terminal v2.0<br>Type 'help' for commands.<br><br></div>
                        <div style="display: flex; align-items: center;">
                            <span style="color: #00ff00;">$ </span>
                            <input type="text" class="terminal-input" id="terminal-input-${windowId}" autocomplete="off">
                        </div>
                    </div>
                `;
                setTimeout(() => initTerminal(windowId), 100);
            } else if (app.isCalculator) {
                content.innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <div style="background: #000; color: #0f0; padding: 20px; margin-bottom: 20px; font-family: monospace; font-size: 2rem; border-radius: 8px;" id="calc-display-${windowId}">0</div>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                            <button onclick="clearCalc('${windowId}')" style="background: #ff4444; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">C</button>
                            <button onclick="calcInput('${windowId}', '/')" style="background: #666; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">√∑</button>
                            <button onclick="calcInput('${windowId}', '*')" style="background: #666; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">√ó</button>
                            <button onclick="calcInput('${windowId}', '-')" style="background: #666; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">-</button>
                            <button onclick="calcInput('${windowId}', '7')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">7</button>
                            <button onclick="calcInput('${windowId}', '8')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">8</button>
                            <button onclick="calcInput('${windowId}', '9')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">9</button>
                            <button onclick="calcInput('${windowId}', '+')" style="background: #666; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem; grid-row: span 2;">+</button>
                            <button onclick="calcInput('${windowId}', '4')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">4</button>
                            <button onclick="calcInput('${windowId}', '5')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">5</button>
                            <button onclick="calcInput('${windowId}', '6')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">6</button>
                            <button onclick="calcInput('${windowId}', '1')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">1</button>
                            <button onclick="calcInput('${windowId}', '2')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">2</button>
                            <button onclick="calcInput('${windowId}', '3')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">3</button>
                            <button onclick="calcInput('${windowId}', '0')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem; grid-column: span 2;">0</button>
                            <button onclick="calcInput('${windowId}', '.')" style="background: #333; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">.</button>
                            <button onclick="calcEquals('${windowId}')" style="background: #007AFF; border: none; padding: 15px; border-radius: 8px; color: white; font-size: 1.2rem;">=</button>
                        </div>
                    </div>
                `;
                window.calcExpression = '';
            } else if (app.isNotes) {
                content.innerHTML = `
                    <div style="height: 100%; display: flex; flex-direction: column;">
                        <div style="padding: 10px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <button onclick="saveNote('${windowId}')" style="background: #007AFF; border: none; padding: 5px 10px; border-radius: 4px; color: white; margin-right: 10px;">Save Note</button>
                            <button onclick="loadNote('${windowId}')" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 4px; color: white;">Load Note</button>
                        </div>
                        <textarea id="notes-content-${windowId}" style="flex: 1; background: rgba(0,0,0,0.3); border: none; color: white; padding: 20px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; resize: none; outline: none; font-size: 14px; line-height: 1.5;" placeholder="Start writing your notes..."></textarea>
                    </div>
                `;
            } else if (app.isWeather) {
                content.innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <h2>Weather Information</h2>
                        <div id="weather-details-${windowId}" style="margin-top: 20px;">
                            <div style="font-size: 4rem; margin: 20px 0;">üå§Ô∏è</div>
                            <div style="font-size: 2rem; margin: 10px 0;">77¬∞F</div>
                            <div style="font-size: 1.2rem; opacity: 0.8;">Partly Cloudy</div>
                            <div style="margin-top: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left;">
                                <div>Humidity: 65%</div>
                                <div>Wind: 8 mph</div>
                                <div>Pressure: 30.12 in</div>
                                <div>UV Index: 6</div>
                            </div>
                        </div>
                    </div>
                `;
            } else if (app.isAbout) {
                content.innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <h2>VplazaOS Modern</h2>
                        <p>Version 2.0</p>
                        <br>
                        <p>A modern operating system interface with single-instance window management.</p>
                        <br>
                        <p>Features:</p>
                        <ul style="text-align: left; max-width: 300px; margin: 0 auto;">
                            <li>Single instance window management</li>
                            <li>Modern UI with blur effects</li>
                            <li>Window dragging and resizing</li>
                            <li>Integrated search and browser</li>
                            <li>Terminal with custom commands</li>
                            <li>Built-in calculator and notes</li>
                            <li>Weather information</li>
                            <li>Linux-style window controls</li>
                        </ul>
                    </div>
                `;
            } else if (app.isTextEditor) {
                content.innerHTML = `
                    <div style="height: 100%; display: flex; flex-direction: column;">
                        <div style="padding: 10px; background: rgba(255,255,255,0.05); border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <button onclick="saveFile('${windowId}')" style="background: #007AFF; border: none; padding: 5px 10px; border-radius: 4px; color: white; margin-right: 10px;">Save</button>
                            <button onclick="openFile('${windowId}')" style="background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); padding: 5px 10px; border-radius: 4px; color: white;">Open</button>
                        </div>
                        <textarea id="editor-content-${windowId}" style="flex: 1; background: rgba(0,0,0,0.3); border: none; color: white; padding: 20px; font-family: monospace; resize: none; outline: none;" placeholder="Start typing..."></textarea>
                    </div>
                `;
            } else if (app.isTaskManager) {
                content.innerHTML = `
                    <div style="padding: 20px;">
                        <h3>Running Applications</h3>
                        <div id="task-list-${windowId}">
                            <div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                <span>VplazaOS System</span>
                                <span>Running</span>
                            </div>
                        </div>
                    </div>
                `;
                updateTaskManager(windowId);
            } else if (app.url) {
                content.innerHTML = `<iframe src="${app.url}" style="width: 100%; height: 100%; border: none;"></iframe>`;
            }

            const resizeHandles = ['n', 's', 'e', 'w', 'ne', 'nw', 'se', 'sw'];
            resizeHandles.forEach(direction => {
                const handle = document.createElement('div');
                handle.className = `resize-handle ${direction}`;
                handle.addEventListener('mousedown', (e) => startResize(e, windowId, direction));
                window.appendChild(handle);
            });

            window.appendChild(header);
            window.appendChild(content);
            document.getElementById('mainArea').appendChild(window);

            const offset = (windowCounter - 1) * 30;
            const maxLeft = window.innerWidth - 880;
            const maxTop = window.innerHeight - 640;
            
            window.style.left = Math.min(100 + offset, maxLeft) + 'px';
            window.style.top = Math.min(50 + offset, maxTop) + 'px';
            window.style.width = '800px';
            window.style.height = '600px';

            setTimeout(() => {
                window.classList.add('show');
            }, 10);

            header.addEventListener('mousedown', (e) => {
                if (!e.target.closest('.window-control')) {
                    startDrag(e, windowId);
                }
            });
        }

        function toggleCustomFullscreen(windowId) {
            const window = document.getElementById(windowId);
            
            if (window.classList.contains('custom-fullscreen')) {
                window.classList.remove('custom-fullscreen');
                window.style.left = '100px';
                window.style.top = '50px';
                window.style.width = '800px';
                window.style.height = '600px';
            } else {
                window.classList.add('custom-fullscreen');
                const iframe = window.querySelector('iframe');
                if (iframe) {
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                }
            }
        }

        function calcInput(windowId, value) {
            const display = document.getElementById(`calc-display-${windowId}`);
            const window = document.getElementById(windowId);
            
            if (display.textContent === '0' && !isNaN(value)) {
                display.textContent = value;
                window.calcExpression = value;
            } else {
                display.textContent += value;
                window.calcExpression += value;
            }
        }

        function clearCalc(windowId) {
            const display = document.getElementById(`calc-display-${windowId}`);
            const window = document.getElementById(windowId);
            display.textContent = '0';
            window.calcExpression = '';
        }

        function calcEquals(windowId) {
            const display = document.getElementById(`calc-display-${windowId}`);
            const window = document.getElementById(windowId);
            
            try {
                const result = eval(window.calcExpression.replace('√ó', '*').replace('√∑', '/'));
                display.textContent = result;
                window.calcExpression = result.toString();
            } catch (error) {
                display.textContent = 'Error';
                window.calcExpression = '';
            }
        }

        function saveNote(windowId) {
            const content = document.getElementById(`notes-content-${windowId}`).value;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'note.txt';
            a.click();
            showNotification('Note Saved', 'Your note has been saved successfully.');
        }

        function loadNote(windowId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById(`notes-content-${windowId}`).value = e.target.result;
                        showNotification('Note Loaded', `Note "${file.name}" loaded successfully.`);
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function saveFile(windowId) {
            const content = document.getElementById(`editor-content-${windowId}`).value;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'document.txt';
            a.click();
            showNotification('File Saved', 'Your document has been saved successfully.');
        }

        function openFile(windowId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        document.getElementById(`editor-content-${windowId}`).value = e.target.result;
                        showNotification('File Loaded', `File "${file.name}" loaded successfully.`);
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function closeWindow(windowId, appName) {
            const window = document.getElementById(windowId);
            window.style.animation = 'windowOpen 0.2s ease reverse';
            setTimeout(() => {
                window.remove();
                activeWindows.delete(windowId);
                openWindows.delete(appName); // Remove from openWindows so it can be opened again
                updateDockActiveApps();
            }, 200);
        }

        function minimizeWindow(windowId) {
            const window = document.getElementById(windowId);
            window.classList.add('minimized');
            setTimeout(() => {
                window.style.display = 'none';
            }, 300);
        }

        function startDrag(e, windowId) {
            const window = document.getElementById(windowId);
            draggedWindow = window;
            
            const rect = window.getBoundingClientRect();
            dragOffset.x = e.clientX - rect.left;
            dragOffset.y = e.clientY - rect.top;
            
            window.style.zIndex = 1000 + windowCounter++;
            window.classList.remove('custom-fullscreen');
            
            e.preventDefault();
        }

        document.addEventListener('mousemove', (e) => {
            if (draggedWindow && !resizingWindow) {
                const newX = e.clientX - dragOffset.x;
                const newY = e.clientY - dragOffset.y;
                
                const windowWidth = parseInt(draggedWindow.style.width);
                const windowHeight = parseInt(draggedWindow.style.height);
                
                const maxLeft = window.innerWidth - windowWidth;
                const maxTop = window.innerHeight - windowHeight;
                
                const boundedX = Math.max(0, Math.min(newX, maxLeft));
                const boundedY = Math.max(0, Math.min(newY, maxTop));
                
                draggedWindow.style.left = boundedX + 'px';
                draggedWindow.style.top = boundedY + 'px';
            }

            if (resizingWindow) {
                handleResize(e);
            }
        });

        document.addEventListener('mouseup', (e) => {
            if (draggedWindow) {
                draggedWindow = null;
            }
            
            resizingWindow = null;
        });

        function startResize(e, windowId, direction) {
            const window = document.getElementById(windowId);
            resizingWindow = window;
            resizeData = {
                direction,
                startX: e.clientX,
                startY: e.clientY,
                startWidth: parseInt(window.style.width),
                startHeight: parseInt(window.style.height),
                startLeft: parseInt(window.style.left),
                startTop: parseInt(window.style.top)
            };
            e.preventDefault();
            e.stopPropagation();
        }

        function handleResize(e) {
            if (!resizingWindow) return;

            const deltaX = e.clientX - resizeData.startX;
            const deltaY = e.clientY - resizeData.startY;
            const direction = resizeData.direction;

            let newWidth = resizeData.startWidth;
            let newHeight = resizeData.startHeight;
            let newLeft = resizeData.startLeft;
            let newTop = resizeData.startTop;

            if (direction.includes('e')) newWidth += deltaX;
            if (direction.includes('w')) {
                newWidth -= deltaX;
                newLeft += deltaX;
            }
            if (direction.includes('s')) newHeight += deltaY;
            if (direction.includes('n')) {
                newHeight -= deltaY;
                newTop += deltaY;
            }

            newWidth = Math.max(400, newWidth);
            newHeight = Math.max(300, newHeight);

            const maxRight = window.innerWidth;
            const maxBottom = window.innerHeight;
            
            if (newLeft + newWidth > maxRight) newWidth = maxRight - newLeft;
            if (newTop + newHeight > maxBottom) newHeight = maxBottom - newTop;
            if (newLeft < 0) newLeft = 0;
            if (newTop < 0) newTop = 0;

            resizingWindow.style.width = newWidth + 'px';
            resizingWindow.style.height = newHeight + 'px';
            resizingWindow.style.left = newLeft + 'px';
            resizingWindow.style.top = newTop + 'px';
        }

        function initTerminal(windowId) {
            const input = document.getElementById(`terminal-input-${windowId}`);
            const output = document.getElementById(`terminal-output-${windowId}`);
            
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    const command = input.value.trim();
                    if (command) {
                        output.innerHTML += `$ ${command}<br>`;
                        executeCommand(command, output, windowId);
                        input.value = '';
                        output.scrollTop = output.scrollHeight;
                    }
                }
            });
            
            setTimeout(() => input.focus(), 100);
        }

        function executeCommand(command, output, windowId) {
            const args = command.split(' ');
            const cmd = args[0].toLowerCase();

            switch (cmd) {
                case 'help':
                    output.innerHTML += 'Available commands:<br>help, clear, echo, date, about, ls, open, close<br><br>';
                    break;
                case 'clear':
                    output.innerHTML = 'VplazaOS Terminal v2.0<br>Type \'help\' for commands.<br><br>';
                    break;
                case 'echo':
                    output.innerHTML += args.slice(1).join(' ') + '<br><br>';
                    break;
                case 'date':
                    output.innerHTML += new Date().toString() + '<br><br>';
                    break;
                case 'about':
                    output.innerHTML += 'VplazaOS Modern v2.0<br>Single-instance window management system<br><br>';
                    break;
                case 'ls':
                    output.innerHTML += 'Applications: browser, terminal, files, about, music, games, calculator, notes, weather<br><br>';
                    break;
                case 'open':
                    if (args[1]) {
                        openApp(args[1]);
                        output.innerHTML += `Opening ${args[1]}...<br><br>`;
                    } else {
                        output.innerHTML += 'Usage: open [app_name]<br><br>';
                    }
                    break;
                case 'close':
                    const appName = document.getElementById(windowId).getAttribute('data-app');
                    closeWindow(windowId, appName);
                    break;
                default:
                    output.innerHTML += `Command not found: ${cmd}<br><br>`;
            }
        }

        function updateTaskManager(windowId) {
            const taskList = document.getElementById(`task-list-${windowId}`);
            let html = '<div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);"><span>VplazaOS System</span><span>Running</span></div>';
            
            activeWindows.forEach((app, id) => {
                html += `<div style="display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <span>${app.title}</span>
                    <div>
                        <button onclick="focusWindow('${id}')" style="background: #007AFF; border: none; padding: 2px 8px; border-radius: 4px; color: white; cursor: pointer; margin-right: 5px;">Focus</button>
                        <button onclick="closeWindow('${id}', '${document.getElementById(id).getAttribute('data-app')}')" style="background: #ff4444; border: none; padding: 2px 8px; border-radius: 4px; color: white; cursor: pointer;">End</button>
                    </div>
                </div>`;
            });
            
            taskList.innerHTML = html;
        }

        function showPowerOptions() {
            const menu = document.createElement('div');
            menu.className = 'notification';
            menu.style.top = '40px';
            menu.style.right = '20px';
            menu.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 10px;">Power Options</div>
                <button onclick="restartSystem()" style="background: #007AFF; border: none; padding: 8px 16px; border-radius: 4px; color: white; cursor: pointer; margin-right: 10px;">Restart</button>
                <button onclick="shutdownSystem()" style="background: #ff4444; border: none; padding: 8px 16px; border-radius: 4px; color: white; cursor: pointer;">Shutdown</button>
            `;
            document.body.appendChild(menu);
            menu.classList.add('show');
            
            setTimeout(() => {
                menu.classList.remove('show');
                setTimeout(() => menu.remove(), 300);
            }, 5000);
        }

        function restartSystem() {
            const bootScreen = document.getElementById('bootScreen');
            bootScreen.style.display = 'flex';
            bootScreen.style.opacity = '1';
            
            document.querySelectorAll('.window').forEach(window => {
                window.remove();
            });
            
            activeWindows.clear();
            openWindows.clear();
            
            setTimeout(startDesktop, 2500);
        }

        function shutdownSystem() {
            const bootScreen = document.getElementById('bootScreen');
            bootScreen.style.display = 'flex';
            bootScreen.style.opacity = '1';
            bootScreen.innerHTML = `
                <div class="boot-logo">VplazaOS</div>
                <div class="boot-text">Shutting down...</div>
            `;
            
            setTimeout(() => {
                document.body.style.backgroundColor = '#000';
                bootScreen.style.opacity = '0';
            }, 2000);
        }
    </script>
</body>
</html>
