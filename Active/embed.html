<!DOCTYPE html>
<html lang="en">
<head>
    <title>Deploying Proxy</title>
    <link href="https://fonts.googleapis.com/css2?family=Cal+Sans&display=swap" rel="stylesheet">
    <style>
        @font-face {
            font-family: 'Inter';
            src: url('images/Inter-Regular.woff2') format('woff2');
            font-weight: 400;
            font-style: normal;
        }
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Cal Sans', Arial, Helvetica, sans-serif;
            height: 100vh;
            width: 100vw;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #000000;
            color: #FFFFFF;
            position: relative;
        }
        
        /* Loading overlay that covers everything until animations complete */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        
        #loading-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        .star {
            position: absolute;
            width: 3px;
            height: 3px;
            background: white;
            box-shadow: 0 0 8px white;
            border-radius: 50%;
            top: 0;
            left: 100%;
            animation: moveStar 2s linear forwards;
        }
        @keyframes moveStar {
            to {
                transform: translateX(-120vw);
                opacity: 0;
            }
        }
        #main {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            z-index: 1;
        }
        #glitch-text {
            font-size: 40px;
            font-weight: 700;
            letter-spacing: 3px;
            text-transform: uppercase;
            animation: none;
            text-shadow: none;
            margin: 0;
            transition: color 1s ease, text-shadow 1s ease, opacity 0.5s ease;
        }
        #glitch-text.red-glow {
            color: red;
            text-shadow: 0 0 20px red, 0 0 40px red, 0 0 60px red, 0 0 80px red;
        }
        .v-red, .x-red {
            color: red;
            text-shadow: 0 0 10px red, 0 0 20px red, 0 0 40px red;
            transition: color 0.5s ease, text-shadow 0.5s ease;
        }
        .plaza-white {
            color: white;
            text-shadow: 0 0 10px white, 0 0 20px white, 0 0 40px white;
            transition: color 0.5s ease, text-shadow 0.5s ease;
        }
    </style>
</head>
<body>
    <!-- Loading overlay that prevents page from being "ready" -->
    <div id="loading-overlay">
        <div id="main">
            <p id="glitch-text">deploying proxy</p>
        </div>
    </div>

    <script>
        // Prevent the page from finishing loading until animations complete
        let animationsComplete = false;
        
        // Override document ready state
        Object.defineProperty(document, 'readyState', {
            get: function() {
                return animationsComplete ? 'complete' : 'loading';
            }
        });

        // Function to mark page as fully loaded
        function markPageAsLoaded() {
            animationsComplete = true;
            
            // Remove loading overlay
            const overlay = document.getElementById('loading-overlay');
            overlay.classList.add('fade-out');
            
            // Dispatch load event
            setTimeout(() => {
                overlay.remove();
                window.dispatchEvent(new Event('load'));
                document.dispatchEvent(new Event('DOMContentLoaded'));
            }, 500);
        }

        const target = document.getElementById('glitch-text');
        const original = target.textContent;
        const chars = 'abcdefghijklmnopqrstuvwxyz';
        let iterations = 0;
        
        const glitchInterval = setInterval(() => {
            let displayed = '';
            for (let i = 0; i < original.length; i++) {
                if (i < iterations) {
                    displayed += original[i];
                } else if (original[i] === ' ') {
                    displayed += ' ';
                } else {
                    displayed += chars[Math.floor(Math.random() * chars.length)];
                }
            }
            target.textContent = displayed;
            iterations += 0.5;
            
            if (iterations >= original.length) {
                clearInterval(glitchInterval);
                target.textContent = original;
                
                setTimeout(() => {
                    target.classList.add('red-glow');
                    
                    setTimeout(() => {
                        target.style.opacity = '0';
                        
                        setTimeout(() => {
                            target.innerHTML = `
                                <span class="v-red">V</span>
                                <span class="plaza-white">plaza</span>
                                <span class="x-red">X</span>
                            `;
                            target.classList.remove('red-glow');
                            target.style.opacity = '1';
                            
                            // Mark animations as complete and allow page to finish loading
                            setTimeout(() => {
                                markPageAsLoaded();
                            }, 200); // Small delay to ensure fade-in is complete
                            
                        }, 500);
                    }, 1000);
                }, 300);
            }
        }, 50);

        function createStar() {
            const star = document.createElement('div');
            star.classList.add('star');
            star.style.top = `${Math.random() * 100}vh`;
            star.style.left = '100%';
            star.style.width = `${Math.random() * 2 + 2}px`;
            star.style.height = star.style.width;
            star.style.animationDuration = `${Math.random() * 1.5 + 0.5}s`;
            document.body.appendChild(star);
            
            star.addEventListener('animationend', () => {
                star.remove();
            });
        }

        setInterval(createStar, 20);
        
        // Prevent default load events until animations complete
        window.addEventListener('load', function(e) {
            if (!animationsComplete) {
                e.stopImmediatePropagation();
            }
        }, true);
        
        document.addEventListener('DOMContentLoaded', function(e) {
            if (!animationsComplete) {
                e.stopImmediatePropagation();
            }
        }, true);
    </script>
    
    <!-- Scripts will only execute after page is marked as loaded -->
    <script src="uv/uv.bundle.js" charset="UTF-8"></script>
    <script src="uv/uv.config.js" charset="UTF-8"></script>
    <script src="register-sw.js"></script>
    <script src="embed.js"></script>
</body>
</html>
